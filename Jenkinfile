node {
    stage('Checkout') {
        checkout scmGit(branches: [[name: '*/main'], [name: '*/master']], extensions: [], userRemoteConfigs: [[credentialsId: 'github_credential', url: 'https://github.com/ngodanghuy162/jenkin_lab']])
            // git branch: 'main',
            //     credentialsId: 'github_credential',
            //     url: 'https://github.com/ngodanghuy162/jenkin_lab.git'
        env.GIT_URL = sh(script: "git config --get remote.origin.url", returnStdout: true).trim()
        env.GIT_BRANCH = sh(script: "git rev-parse --abbrev-ref HEAD", returnStdout: true).trim()
        env.GIT_COMMIT = sh(script: "git rev-parse HEAD", returnStdout: true).trim()
    }

    stage('Info') {
        echo "Tên job: ${env.JOB_NAME}"
        echo "ID build: ${env.BUILD_ID}"
        echo "Từ nhánh: ${env.BRANCH_NAME}"
        echo "Commit hiện tại: ${env.GIT_COMMIT}"
        echo "Workspace: ${env.WORKSPACE}"
    }

    // Chạy test chỉ khi có push lên Git
    if (env.GIT_BRANCH !=~ /tags/) {
        stage('Build') {
            echo "Build khi có push"
        }

        stage('Test') {
            echo 'Test'
        }
    }

    // Chỉ build và push image khi có tag mới
    if (env.GIT_TAG) {
        stage('Build Docker Image') {
            echo "Build image khi có tag"
        }
    }
}
